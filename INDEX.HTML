<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Habi - Repaso de Pol√≠ticas</title>
    <!-- Carga de Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos personalizados para el modo oscuro elegante */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0f172a; /* Slate 900 */
        }
        .card {
            background-color: #1e293b; /* Slate 800 */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            opacity: 0; /* Inicialmente oculto para la animaci√≥n de inicio */
            animation: fadeIn 1s ease-out forwards 0.3s; /* Animaci√≥n de entrada */
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 25px -5px rgba(0, 0, 0, 0.4);
        }
        .option-btn {
            background-color: #334155; /* Slate 700 */
            border: 1px solid #475569; /* Slate 600 */
            transition: all 0.2s ease;
            text-align: left;
            white-space: normal;
        }
        .option-btn:hover:not(.disabled) {
            background-color: #475569; /* Slate 600 */
            transform: scale(1.01);
        }
        .option-btn.correct {
            background-color: #10b981; /* Esmeralda 500 */
            border-color: #059669;
            color: white;
            animation: pulse-green 1s ease-in-out;
        }
        .option-btn.incorrect {
            background-color: #ef4444; /* Rojo 500 */
            border-color: #dc2626;
            color: white;
            animation: shake 0.5s;
        }
        .progress-bar-fill {
            transition: width 0.4s ease-in-out;
        }
        
        /* Animaciones */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
            100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20%, 60% { transform: translateX(-5px); }
            40%, 80% { transform: translateX(5px); }
        }

        /* Agregando animaciones de Tailwind CSS, si est√°n disponibles, para el feedback final */
        .animate-bounce {
            animation: bounce 1s infinite;
        }
        .animate-pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes bounce {
            0%, 100% { transform: translateY(-10%); animation-timing-function: cubic-bezier(0.8, 0, 1, 1); }
            50% { transform: translateY(0); animation-timing-function: cubic-bezier(0, 0, 0.2, 1); }
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <div id="quiz-container" class="w-full max-w-2xl">
        
        <!-- Contenedor Principal del Quiz -->
        <div id="quiz-card" class="card rounded-xl p-6 md:p-10 text-white transition duration-500 ease-in-out">
            <h1 class="text-3xl font-bold mb-2 text-center text-emerald-400">Repaso de Pol√≠ticas Habi</h1>
            <!-- T√≠tulo de Colaboraci√≥n - Color cambiado a text-yellow-400 para mejor contraste -->
            <p class="text-xs text-center mb-6 text-yellow-400 italic">Creado por Jos√© Jimy G. en colaboraci√≥n con la suite de Google y el poder de Gemini.</p>

            <!-- Barra de Progreso -->
            <div class="mb-8">
                <div class="flex justify-between text-sm mb-1 text-slate-400">
                    <span id="current-question-count">Pregunta 1</span>
                    <span id="score-count">Aciertos: 0</span>
                </div>
                <div class="w-full bg-slate-700 rounded-full h-2.5">
                    <div id="progress-bar" class="progress-bar-fill bg-emerald-500 h-2.5 rounded-full" style="width: 0%"></div>
                </div>
            </div>

            <!-- Secci√≥n de Pregunta y Opciones -->
            <div id="question-section">
                <h2 id="question-text" class="text-xl font-semibold mb-6">Cargando pregunta...</h2>
                <div id="options-container" class="space-y-4">
                    <!-- Opciones se insertar√°n aqu√≠ por JS -->
                </div>
                
                <!-- Bot√≥n de Siguiente (Oculto inicialmente) -->
                <button id="next-btn" class="hidden w-full mt-6 py-3 px-4 bg-teal-600 hover:bg-teal-700 rounded-lg font-bold transition duration-200" onclick="nextQuestion()">
                    Siguiente Pregunta
                </button>
            </div>

            <!-- Secci√≥n de Resultados (Oculta inicialmente) -->
            <div id="results-section" class="hidden text-center">
                <h2 class="text-3xl font-bold text-emerald-400 mb-4">¬°Repaso Completado!</h2>
                
                <!-- Contenedor para el feedback final animado (NUEVO) -->
                <div id="final-feedback-container" class="mb-6 p-4 rounded-xl">
                    <!-- Contenido din√°mico (animado) se insertar√° aqu√≠ -->
                </div>
                
                <p id="final-score" class="text-5xl font-extrabold mb-6"></p>

                <!-- Gr√°fico de Resultados (Barra) -->
                <div class="mb-8 p-5 rounded-lg bg-slate-700">
                    <h3 class="text-xl font-semibold mb-3 border-b border-slate-600 pb-2 text-emerald-300">Estad√≠sticas por √Årea</h3>
                    <div id="stats-chart" class="text-left space-y-3">
                        <!-- Las estad√≠sticas se insertar√°n aqu√≠ -->
                    </div>
                </div>

                <!-- Resumen y Mejoras -->
                <div class="text-left bg-slate-700 p-5 rounded-lg mb-6">
                    <h3 class="text-xl font-semibold mb-3 text-red-300 border-b border-slate-600 pb-2">√Åreas de Oportunidad</h3>
                    <ul id="improvement-feedback" class="list-disc list-inside space-y-2 text-slate-200">
                        <!-- Feedback de mejora se insertar√° aqu√≠ -->
                    </ul>
                </div>

                <!-- Revisi√≥n de Errores -->
                <div class="text-left bg-slate-700 p-5 rounded-lg mb-6">
                    <h3 class="text-xl font-semibold mb-4 text-yellow-300 border-b border-slate-600 pb-2">Tus Respuestas vs. Correctas</h3>
                    <div id="detailed-review" class="space-y-6">
                        <!-- Detalles de las preguntas fallidas se insertar√°n aqu√≠ -->
                    </div>
                </div>
                
                <!-- Bot√≥n de Reiniciar -->
                <button class="w-full py-3 px-4 bg-blue-600 hover:bg-blue-700 rounded-lg font-bold transition duration-200" onclick="startQuiz()">
                    Reiniciar Quiz
                </button>
            </div>

        </div>
    </div>

    <script type="text/javascript">
        // 1. Data del Quiz (Preguntas, respuestas correctas e incorrectas)
        const quizData = [
            {
                category: "Compra",
                question: "¬øCu√°l es el valor de la Tarifa de Derechos de Compra (DdC) y a qu√© se destina este cargo?",
                correct: "El valor es del 1% + IVA del precio del inmueble, destinado a cubrir costos operativos, tecnol√≥gicos y administrativos.",
                options: [
                    "El valor es del 2% + IVA del precio del inmueble, destinado a reserva legal.",
                    "El valor es del 1% del precio (sin IVA), destinado a gastos de notar√≠a.",
                    "El valor es del 0.5% + IVA del precio del inmueble, destinado a publicidad y marketing."
                ],
                selectedAnswer: null, // Campo para rastrear la respuesta del usuario
                isCorrect: false
            },
            {
                category: "Compra",
                question: "Seg√∫n el cronograma, ¬øcu√°nto tiempo tiene el cliente para pagar la separaci√≥n despu√©s de firmar la Carta de Intenci√≥n (CI) y qu√© sucede si no realiza dicho pago?",
                correct: "El cliente tiene 4 d√≠as para pagar la separaci√≥n. En caso de no hacerlo, el negocio se desiste autom√°ticamente.",
                options: [
                    "El cliente tiene 10 d√≠as para pagar la separaci√≥n, y si no lo hace se le cobra una multa.",
                    "El cliente tiene 2 d√≠as para pagar, con una posible extensi√≥n de 24 horas con penalizaci√≥n.",
                    "El cliente tiene 7 d√≠as para pagar, tras lo cual se renegocia la Carta de Intenci√≥n."
                ],
                selectedAnswer: null,
                isCorrect: false
            },
            {
                category: "Compra",
                question: "¬øCu√°l es el tiempo estimado de duraci√≥n del proceso (firma de promesa a escrituras) si el negocio es con cr√©dito, y si es de contado?",
                correct: "Con cr√©dito: ‚âà 1 mes despu√©s de la promesa. De contado: ‚âà 15 d√≠as despu√©s de la promesa.",
                options: [
                    "Con cr√©dito: ‚âà 15 d√≠as. De contado: ‚âà 1 mes.",
                    "En ambos casos, el proceso dura ‚âà 2 meses.",
                    "En ambos casos, el proceso dura ‚âà 30 d√≠as."
                ],
                selectedAnswer: null,
                isCorrect: false
            },
            {
                category: "Cr√©ditos",
                question: "¬øQu√© requisitos de antig√ºedad laboral deben cumplir los clientes catalogados como empleados (contrato fijo e indefinido)?",
                correct: "Contrato indefinido: M√°s de 6 meses de antig√ºedad. Contrato fijo: M√°s de 1 a√±o de antig√ºedad.",
                options: [
                    "Contrato indefinido: M√°s de 1 a√±o de antig√ºedad. Contrato fijo: M√°s de 6 meses de antig√ºedad.",
                    "Ambos tipos de contrato requieren m√°s de 3 meses de antig√ºedad.",
                    "Ambos tipos de contrato requieren m√°s de 2 a√±os de antig√ºedad."
                ],
                selectedAnswer: null,
                isCorrect: false
            },
            {
                category: "Cr√©ditos",
                question: "¬øBajo qu√© condiciones un cliente debe ser referido a Habicredit antes de subir la oferta de compra?",
                correct: "Todo cliente que tenga cr√©dito preaprobado con bancos o no tenga cr√©dito, si se tiene una oferta de compra.",
                options: [
                    "Solo clientes que no tienen cr√©dito preaprobado.",
                    "Solo clientes que pagan con subsidio.",
                    "Solo clientes que pagan de contado."
                ],
                selectedAnswer: null,
                isCorrect: false
            },
            {
                category: "Cr√©ditos",
                question: "¬øQu√© formas de pago NO aplican para ser referidas a Habicredit (excepciones)?",
                correct: "FNA, contado, Subsidio y Cesant√≠as Caja Honor, y cr√©ditos convencionados.",
                options: [
                    "Cr√©dito preaprobado con bancos.",
                    "Cr√©dito sin preaprobaci√≥n.",
                    "Cr√©dito para vivienda nueva."
                ],
                selectedAnswer: null,
                isCorrect: false
            },
            {
                category: "Cr√©ditos",
                question: "Si hay un desajuste en el valor del cr√©dito, ¬øqu√© porcentaje asumir√° Habi para cubrirlo bajo el beneficio HabiCredit?",
                correct: "Habi asumir√° hasta un 1% del valor del cr√©dito estipulado en la CI.",
                options: [
                    "Habi asumir√° hasta un 3% del valor total de la PCV.",
                    "Habi asumir√° hasta el 0.5% del valor del inmueble.",
                    "Habi asumir√° el 100% de la diferencia."
                ],
                selectedAnswer: null,
                isCorrect: false
            },
            {
                category: "Clientes",
                question: "¬øCu√°les son los cuatro objetivos principales de la actividad de perfilaci√≥n del cliente en Habi?",
                correct: "Entender al cliente, Detectar problemas reales, Conectar emocionalmente, Aumentar la posibilidad de cierre.",
                options: [
                    "Incrementar la base de datos, Generar reportes de CRM, Analizar la competencia, Reducir el tiempo de visita.",
                    "Determinar el valor m√°ximo, Establecer la antig√ºedad laboral, Negociar el precio, Firmar la PCV.",
                    "Revisar el Certificado de Tradici√≥n, Contactar al banco, Solicitar la CI, Revisar el correo de autorizaci√≥n."
                ],
                selectedAnswer: null,
                isCorrect: false
            },
            {
                category: "Clientes",
                question: "¬øQu√© documentos debe el broker verificar (en el portal) y llevar impresos para la visita a inmuebles?",
                correct: "Verificar el correo de autorizaci√≥n (Habi) o confirmaci√≥n (Captados), y llevar impreso el formato de carta oferta.",
                options: [
                    "Verificar el recibo de servicios p√∫blicos y llevar impreso el Certificado de Tradici√≥n.",
                    "Verificar el aval√∫o del inmueble y llevar impreso el plan de pagos.",
                    "Verificar el RUT y llevar impreso el contrato de arras."
                ],
                selectedAnswer: null,
                isCorrect: false
            },
            {
                category: "Clientes",
                question: "¬øEn qu√© caso se otorga una compensaci√≥n al broker (50% DdC) y cu√°l es el l√≠mite?",
                correct: "Si el negocio desiste despu√©s del pago de DdC y antes de la PCV. L√≠mite: 1 desistimiento al mes y m√°x. 3 al a√±o.",
                options: [
                    "Si el negocio desiste antes del pago de DdC. L√≠mite: 2 desistimientos al mes y m√°x. 5 al a√±o.",
                    "Si el broker renuncia. L√≠mite: 1 vez.",
                    "Si el cliente no paga la separaci√≥n. Sin l√≠mite de compensaci√≥n."
                ],
                selectedAnswer: null,
                isCorrect: false
            },
            {
                category: "Inventario",
                question: "¬øCu√°les son los tres tipos de inventario de inmuebles y qu√© formas de pago son excluidas para Inmuebles Habi Renta4?",
                correct: "Tipos: Habi Renta4, Habi Alianza, e Inmuebles Captados. Excluidas para Renta4: Subsidios ni Cr√©dito Hipotecario Caja Honor.",
                options: [
                    "Tipos: Nuevo, Usado, Remodelado. Excluidas para Renta4: Contado.",
                    "Tipos: Directo, Indirecto, Mixto. Excluidas para Renta4: Cr√©dito bancario.",
                    "Tipos: Residencial, Comercial, Industrial. Excluidas para Renta4: Cesant√≠as."
                ],
                selectedAnswer: null,
                isCorrect: false
            },
            {
                category: "Inventario",
                question: "¬øCu√°l es la regla de ofertas para Inmuebles Habi cuando la oferta se presenta por debajo del precio de publicaci√≥n (con cr√©dito o caja honor)?",
                correct: "Entra en un contador de 24 horas, ganando la oferta con mejor rentabilidad.",
                options: [
                    "La oferta es rechazada autom√°ticamente.",
                    "Se negocia el precio con el due√±o.",
                    "Se acepta la primera oferta que llegue, independientemente de la rentabilidad."
                ],
                selectedAnswer: null,
                isCorrect: false
            },
        ];

        // 2. Variables de Estado
        let currentQuestionIndex = 0;
        let score = 0;
        let answered = false;
        let incorrectAnswersByCategory = {};
        const totalQuestions = quizData.length;

        // 3. Funciones de Utilidad
        // Mezcla un array (Algoritmo Fisher-Yates)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // Renderiza la pregunta actual
        function renderQuestion() {
            if (currentQuestionIndex >= totalQuestions) {
                showResults();
                return;
            }

            const qData = quizData[currentQuestionIndex];
            const optionsContainer = document.getElementById('options-container');
            
            // Reiniciar estado
            answered = false;
            optionsContainer.innerHTML = '';
            document.getElementById('question-text').textContent = qData.question;
            document.getElementById('next-btn').classList.add('hidden');
            
            // Actualizar contador y barra de progreso
            document.getElementById('current-question-count').textContent = `Pregunta ${currentQuestionIndex + 1} de ${totalQuestions}`;
            document.getElementById('score-count').textContent = `Aciertos: ${score}`;
            const progress = (currentQuestionIndex / totalQuestions) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;


            // Combinar respuesta correcta con incorrectas y mezclar
            const allOptions = [qData.correct, ...qData.options];
            shuffleArray(allOptions);

            allOptions.forEach(optionText => {
                const button = document.createElement('button');
                button.textContent = optionText.replace(/\\/g, ''); // Limpieza de backslashes para visualizaci√≥n
                button.className = 'option-btn w-full py-3 px-4 rounded-lg text-white font-medium text-sm transition duration-200 focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-opacity-50';
                button.setAttribute('data-answer', optionText);
                button.onclick = () => checkAnswer(button, optionText, qData);
                optionsContainer.appendChild(button);
            });
        }

        // Verifica la respuesta seleccionada
        function checkAnswer(selectedButton, selectedText, qData) {
            if (answered) return;
            answered = true;
            
            qData.selectedAnswer = selectedText; // Guardar la respuesta del usuario
            const category = qData.category;
            const correctText = qData.correct;


            const allButtons = document.getElementById('options-container').querySelectorAll('button');
            allButtons.forEach(btn => btn.classList.add('disabled')); // Desactivar todos

            if (selectedText === correctText) {
                score++;
                qData.isCorrect = true; // Marcar como correcta
                selectedButton.classList.remove('bg-slate-700');
                selectedButton.classList.add('correct');
            } else {
                // Registrar error por categor√≠a
                incorrectAnswersByCategory[category] = (incorrectAnswersByCategory[category] || 0) + 1;
                qData.isCorrect = false; // Marcar como incorrecta
                
                selectedButton.classList.remove('bg-slate-700');
                selectedButton.classList.add('incorrect');

                // Resaltar la respuesta correcta
                allButtons.forEach(btn => {
                    if (btn.getAttribute('data-answer') === correctText) {
                        btn.classList.add('correct');
                    }
                });
            }

            document.getElementById('next-btn').textContent = (currentQuestionIndex === totalQuestions - 1) ? "Ver Resultados" : "Siguiente Pregunta";
            document.getElementById('next-btn').classList.remove('hidden');
            document.getElementById('score-count').textContent = `Aciertos: ${score}`;
        }

        // Pasa a la siguiente pregunta
        function nextQuestion() {
            currentQuestionIndex++;
            renderQuestion();
        }

        // Renderiza el mensaje final animado basado en la puntuaci√≥n (NUEVA FUNCI√ìN)
        function renderFinalFeedback(percentage) {
            const container = document.getElementById('final-feedback-container');
            let emoji = '';
            let message = '';
            let colorClass = '';
            let animationClass = '';

            if (percentage >= 80) {
                emoji = 'üèÜ';
                message = '¬°Excelente trabajo! Dominas las pol√≠ticas de Habi. ¬°Sigue as√≠!';
                colorClass = 'bg-emerald-600/20 text-emerald-300';
                animationClass = 'animate-bounce';
            } else if (percentage >= 50) {
                emoji = 'üëç';
                message = 'Buen desempe√±o. Tienes una base s√≥lida, pero hay espacio para reforzar algunos temas clave.';
                colorClass = 'bg-yellow-600/20 text-yellow-300';
                animationClass = 'animate-pulse';
            } else {
                emoji = 'üìö';
                message = 'Hay √°reas importantes por repasar. ¬°√Ånimo! El conocimiento est√° a tu alcance.';
                colorClass = 'bg-red-600/20 text-red-300';
                animationClass = 'animate-none'; 
            }

            container.className = `mb-6 p-4 rounded-xl ${colorClass}`;
            container.innerHTML = `
                <div class="flex items-center justify-center space-x-3">
                    <span class="text-4xl ${animationClass} transition duration-500">${emoji}</span>
                    <p class="text-lg font-medium">${message}</p>
                </div>
            `;
        }


        // Muestra la pantalla de resultados
        function showResults() {
            document.getElementById('question-section').classList.add('hidden');
            document.getElementById('results-section').classList.remove('hidden');
            
            // Barra de progreso final
            document.getElementById('progress-bar').style.width = '100%';
            document.getElementById('current-question-count').textContent = `¬°Finalizado!`;

            const percentage = Math.round((score / totalQuestions) * 100);
            document.getElementById('final-score').innerHTML = `Puntuaci√≥n: ${score} / ${totalQuestions} <br><span class="text-2xl text-slate-300">(${percentage}%)</span>`;
            
            // Llamada a la nueva funci√≥n de feedback animado
            renderFinalFeedback(percentage); 
            renderStatsChart();
            renderImprovementFeedback();
            renderDetailedReview();
        }

        // Renderiza el gr√°fico de estad√≠sticas (Barras simples con Tailwind)
        function renderStatsChart() {
            const chartContainer = document.getElementById('stats-chart');
            chartContainer.innerHTML = '';
            
            // Agrupar preguntas por categor√≠a y calcular el total por categor√≠a
            const totalQuestionsByCategory = quizData.reduce((acc, q) => {
                acc[q.category] = (acc[q.category] || 0) + 1;
                return acc;
            }, {});

            const categories = Object.keys(totalQuestionsByCategory);

            categories.forEach(category => {
                const total = totalQuestionsByCategory[category];
                const incorrect = incorrectAnswersByCategory[category] || 0;
                const correct = total - incorrect;
                const percent = Math.round((correct / total) * 100);
                // Usamos una clase de animaci√≥n simple en la barra para un toque interactivo
                const color = percent >= 80 ? 'bg-emerald-500' : (percent >= 50 ? 'bg-yellow-500' : 'bg-red-500');

                const statBar = `
                    <div>
                        <div class="flex justify-between mb-1 text-sm">
                            <span class="font-medium">${category}</span>
                            <span class="font-bold text-sm ${color.replace('bg-', 'text-')}">${correct} / ${total} (${percent}%)</span>
                        </div>
                        <div class="w-full bg-slate-600 rounded-full h-3 overflow-hidden">
                            <div class="${color} h-3 rounded-full transition-all duration-700 ease-out" style="width: ${percent}%"></div>
                        </div>
                    </div>
                `;
                chartContainer.innerHTML += statBar;
            });
        }

        // Genera el feedback de mejora
        function renderImprovementFeedback() {
            const feedbackList = document.getElementById('improvement-feedback');
            feedbackList.innerHTML = '';

            const categoriesWithErrors = Object.keys(incorrectAnswersByCategory).sort((a, b) => incorrectAnswersByCategory[b] - incorrectAnswersByCategory[a]);

            if (categoriesWithErrors.length === 0) {
                feedbackList.innerHTML = '<li class="text-emerald-300">¬°Felicidades! Tuviste un rendimiento perfecto. Sigue as√≠.</li>';
                return;
            }

            // Top 3 categor√≠as con m√°s errores
            categoriesWithErrors.slice(0, 3).forEach(category => {
                const numErrors = incorrectAnswersByCategory[category];
                let suggestion = '';

                switch (category) {
                    case 'Compra':
                        suggestion = `Revisa los plazos y los costos asociados al proceso de compra (Tarifa DdC, separaci√≥n y tiempos de escrituraci√≥n).`;
                        break;
                    case 'Cr√©ditos':
                        suggestion = `Profundiza en la perfilaci√≥n bancaria, los requisitos de antig√ºedad laboral y las reglas de referenciaci√≥n a HabiCredit.`;
                        break;
                    case 'Clientes':
                        suggestion = `Revisa los objetivos de la perfilaci√≥n, los documentos necesarios para las visitas y las pol√≠ticas de compensaci√≥n por desistimiento.`;
                        break;
                    case 'Inventario':
                        suggestion = `Repasa los tipos de inventario y las reglas espec√≠ficas para la gesti√≥n y aprobaci√≥n de ofertas.`;
                        break;
                    default:
                        suggestion = `Revisa los temas relacionados con ${category}.`;
                        break;
                }
                feedbackList.innerHTML += `<li><span class="font-bold text-red-300">${category} (${numErrors} error${numErrors > 1 ? 'es' : ''}):</span> ${suggestion}</li>`;
            });
        }

        // Muestra el detalle de preguntas fallidas
        function renderDetailedReview() {
            const reviewContainer = document.getElementById('detailed-review');
            reviewContainer.innerHTML = '';

            quizData.forEach((q, index) => {
                if (!q.isCorrect) {
                    const yourAnswer = q.selectedAnswer || 'No respondida';
                    const detail = `
                        <div class="p-4 border border-red-500/30 rounded-lg bg-slate-800 shadow-lg">
                            <p class="text-sm text-slate-400 mb-1">Categor√≠a: <span class="font-medium text-yellow-400">${q.category}</span></p>
                            <p class="font-semibold text-white mb-3">P${index + 1}: ${q.question}</p>
                            
                            <!-- Respuesta Correcta -->
                            <div class="bg-emerald-800/50 p-3 rounded-lg mb-2">
                                <span class="font-bold text-emerald-300 block">‚úîÔ∏è Correcta:</span>
                                <span class="text-sm text-emerald-100">${q.correct.replace(/\\/g, '')}</span>
                            </div>

                            <!-- Respuesta del Usuario -->
                            <div class="bg-red-800/50 p-3 rounded-lg">
                                <span class="font-bold text-red-300 block">‚ùå Tu Respuesta:</span>
                                <span class="text-sm text-red-100">${yourAnswer.replace(/\\/g, '')}</span>
                            </div>
                        </div>
                    `;
                    reviewContainer.innerHTML += detail;
                }
            });

            if (reviewContainer.innerHTML === '') {
                 reviewContainer.innerHTML = '<p class="text-center text-emerald-300">¬°Todas las preguntas fueron respondidas correctamente! No hay errores que repasar.</p>';
            }
        }


        // 4. Inicializaci√≥n
        function startQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            incorrectAnswersByCategory = {};
            
            // Resetear estado de las preguntas
            quizData.forEach(q => {
                q.selectedAnswer = null;
                q.isCorrect = false;
            });
            
            // Mezclar preguntas para variedad
            shuffleArray(quizData); 
            
            document.getElementById('question-section').classList.remove('hidden');
            document.getElementById('results-section').classList.add('hidden');
            document.getElementById('quiz-card').scrollIntoView({ behavior: 'smooth' });

            renderQuestion();
        }

        // Iniciar el quiz al cargar la p√°gina
        window.onload = startQuiz;

    </script>
</body>
</html>
